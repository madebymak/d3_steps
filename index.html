<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Steps</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
  </head>
  <body>
		<svg width="960" height="500"></svg>

		<script src="https://d3js.org/d3.v4.min.js"></script>
    <script>

			var svg = d3.select("svg")

	    //D3 margins
	    var margin = {
	      top: 20,
	      right: 20,
	      bottom: 30,
	      left: 40
	    };

      var width = +svg.attr("width") - margin.left - margin.right;
      var height = +svg.attr("height") - margin.top - margin.bottom;

      //converts to JS Date Obj
			var parseDate = d3.timeParse("%d-%b-%y");

			//date format for tooltip
			var formatTime = d3.timeFormat("%b %e");

      //x axis
			var x = d3.scaleBand()
				.rangeRound([0, width])
				.padding(0.1);

      //y axis inverted
			var y = d3.scaleLinear()
				.rangeRound([height, 0]);

      // //x axis text
      // var xAxis = d3.svg.axis()
      //   .scale(x)
      //   .orient("bottom")
			// 	.tickFormat(d3.time.format("%b %e"))
			// 	.ticks(5)
			//
      // //y axis value
      // var yAxis = d3.svg.axis()
      //   .scale(y)
      //   .orient("left")
			// 	.ticks(3)
			// 	.outerTickSize(0);
			//
      // //D3 path generator
      // var line = d3.svg.line()
      //   .x(function(d) {
      //     return x(d.date);
      //   })
      //   .y(function(d) {
      //     return y(d.steps);
      //   });
			//
      // //SVG container
      // var svg = d3.select("body")
      //   .append("svg")
      //   .attr("width", width + margin.left + margin.right)
      //   .attr("height", height + margin.top + margin.bottom)
      //   .append("g")
      //   .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

				var g = svg.append("g")
    			.attr("transform", "translate(" + 0 + "," + 0+ ")");
					// .attr("transform", "translate(" + margin.left + "," + margin.top + ")");



				// //create div for tooltip
				// var div = d3.select("body").append("div")
				// 	.attr("class", "tooltip")
				// 	.style("opacity", 0);

				// //line for healthy number of steps
				// svg.append("line")
				// 	.attr("class", "line")
				// 	.attr("x1", 0)
				// 	.attr("y1", 140)
				// 	.attr("x2", width)
				// 	.attr("y2", 140)
				// 	.attr("fill", "none")
				// 	.attr("stroke", "green")
				//
				// //line for average number of steps
				// svg.append("line")
				// 	.attr("class", "line")
				// 	.attr("x1", 0)
				// 	.attr("y1", 300)
				// 	.attr("x2", width)
				// 	.attr("y2", 300)
				// 	.attr("fill", "none")
				// 	.attr("stroke", "blue")

        //load data
        d3.tsv("data.tsv", function(err, data) {

          //converts data from file to usable JS data
          data.forEach(function(d) {
						d.date = formatTime(parseDate(d.date));
            //the "+" converts string to number in JS
            d.steps = +d.steps;
          });

					x.domain(data.map(function(d) {
						return d.date;
					}));

					var maxY = d3.max(data, function(d) {
						return d.steps;
					});

					//set min bar height
					y.domain([-(maxY * .02), maxY]);

					// y.domain([0, d3.max(data, function(d) {
					// 	return d.steps;
					// })]);

          svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
						.call(d3.axisBottom(x))
						.selectAll("text")
						.style("text-anchor", "end")
						.attr("dx", "-.8em")
						.attr("dy", "-.55em")
						.attr("transform", "rotate(-90)");

					svg.append("g")
						.attr("class", "y axis")
						.call(d3.axisRight(y).ticks(3))
						.attr("transform", "translate(" + width + ",0)")


				  g.selectAll(".bar")
				    .data(data)
				    .enter().append("rect")
				      .attr("class", "bar")
				      .attr("x", function(d) {
								return x(d.date);
							})
				      .attr("y", function(d) {
								return y(d.steps);
							})
				      .attr("width", x.bandwidth())
				      .attr("height", function(d) {
								return height - y(d.steps);
							 });

					// svg.append("path")
					// 	.datum(data)
					// 	.attr("class", "line")
					// 	.attr("d", line)
					// 	.attr("fill", "none")
					// 	.attr("stroke", "red")

						//create dots for tooltip
						// svg.selectAll("dot")
						// 	.data(data)
						// 	.enter().append("circle")
						// 	.attr("r", 5)
						// 	.attr("cx", function(d) {
						// 		return x(d.date)
						// 	})
						// 	.attr("cy", function(d) {
						// 		return y(d.steps)
						// 	})
						// 	.on("mouseover", function(d) {
						// 		div.transition()
						// 			.duration(200)
						// 			.style("opacity", 0.9)
						// 		div.html(formatTime(d.date) + "</br>" +d.steps + " steps")
						// 			.style("left", (d3.event.pageX) + "px")
						// 			.style("top", (d3.event.pageY - 28) + "px");
						// 	})
						// 	.on("mouseout", function(d) {
						// 		div.transition()
						// 			.duration(500)
						// 			.style("opacity", 0);
						// 	});

						//Title of chart
					svg.append("text")
						.attr("x", (width + (margin.left + margin.right) )/ 2)
						.attr("y", -10)
						.attr("text-anchor", "middle")
						.text("Tracking Steps");

					//Curtain to cover chart
					// var curtain = svg.append("rect")
					// 	.attr("x", -1 * width)
					// 	.attr("y", -1 * height)
					// 	.attr("height", height)
					// 	.attr("width", width)
					// 	.attr("class", "curtain")
					// 	.attr("transform", "rotate(180)")
					// 	.style("fill", "#FFFFFF");
					//
					// 	//transition to move curtain
					// 	var t = svg.transition()
					// 		.delay(750)
					// 		.duration(8000)
					// 		.ease("linear");
					//
					// 	t.select('rect.curtain')
					// 	.attr("width", 0);

        });

    </script>
  </body>
</html>
